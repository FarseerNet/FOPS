@page "/main"
@page "/"
@inject IJSRuntime js;
@using FS.Extends
@using FOPS.Abstract.Fss.Server
@using FOPS.Abstract.MetaInfo.Server
@inject IIocManager _iocManager;
@inject NavigationManager nav;

<div class="layui-row layui-col-space15">
    <div class="layui-col-sm6 layui-col-md3">
        <div class="layui-card">
            <div class="layui-card-header">
                项目数
                <span class="layui-badge layui-bg-blue layuiadmin-badge">P</span>
            </div>
            <div class="layui-card-body layuiadmin-card-list">
                <p class="layuiadmin-big-font">@_projectCount</p>
                <p>
                    Git数量
                    <span class="layuiadmin-span-color">@_gitCount <i class="layui-inline layui-icon layui-icon-flag"></i></span>
                </p>
            </div>
        </div>
    </div>
    <div class="layui-col-sm6 layui-col-md3">
        <div class="layui-card">
            <div class="layui-card-header">
                未展示
                <span class="layui-badge layui-bg-cyan layuiadmin-badge">月</span>
            </div>
            <div class="layui-card-body layuiadmin-card-list">
                <p class="layuiadmin-big-font">0</p>
                <p>
                    未展示
                    <span class="layuiadmin-span-color">0 <i class="layui-inline layui-icon layui-icon-face-smile-b"></i></span>
                </p>
            </div>
        </div>
    </div>
    <div class="layui-col-sm6 layui-col-md3">
        <div class="layui-card">
            <div class="layui-card-header">
                未展示
                <span class="layui-badge layui-bg-green layuiadmin-badge">年</span>
            </div>
            <div class="layui-card-body layuiadmin-card-list">

                <p class="layuiadmin-big-font">0</p>
                <p>
                    未展示
                    <span class="layuiadmin-span-color">*** <i class="layui-inline layui-icon layui-icon-dollar"></i></span>
                </p>
            </div>
        </div>
    </div>
    <div class="layui-col-sm6 layui-col-md3">
        <div class="layui-card">
            <div class="layui-card-header">
                未展示
                <span class="layui-badge layui-bg-orange layuiadmin-badge">月</span>
            </div>
            <div class="layui-card-body layuiadmin-card-list">

                <p class="layuiadmin-big-font">0</p>
                <p>
                    未展示
                    <span class="layuiadmin-span-color">0 <i class="layui-inline layui-icon layui-icon-user"></i></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="layui-row layui-col-space15">
<div class="layui-col-md8">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md6">
            <div class="layui-card">
                <div class="layui-card-header">FSS调度中心</div>
                <div class="layui-card-body">

                    <div class="layui-carousel layadmin-carousel layadmin-backlog">
                        <div carousel-item>
                            <ul class="layui-row layui-col-space10 layui-this">
                                <li class="layui-col-xs6">
                                    <a lay-href="app/content/comment.html" class="layadmin-backlog-body">
                                        <h3>任务数</h3>
                                        <p>
                                            <cite>@_taskGroupCount</cite>
                                        </p>
                                    </a>
                                </li>
                                <li class="layui-col-xs6">
                                    <a lay-href="app/forum/list.html" class="layadmin-backlog-body">
                                        <h3>未执行</h3>
                                        <p>
                                            <cite>@_unExecuteCount</cite>
                                        </p>
                                    </a>
                                </li>
                                <li class="layui-col-xs6">
                                    <a lay-href="template/goodslist.html" class="layadmin-backlog-body">
                                        <h3>客户端</h3>
                                        <p>
                                            <cite>@_clientCount</cite>
                                        </p>
                                    </a>
                                </li>
                                <li class="layui-col-xs6">
                                    <a href="javascript:;" onclick="layer.tips('不跳转', this, {tips: 3});" class="layadmin-backlog-body">
                                        <h3>今日失败</h3>
                                        <p>
                                            <cite>@_todayFailCount</cite>
                                        </p>
                                    </a>
                                </li>
                            </ul>
                            <ul class="layui-row layui-col-space10">
                                <li class="layui-col-xs6">
                                    <a href="javascript:;" class="layadmin-backlog-body">
                                        <h3>待审友情链接</h3>
                                        <p>
                                            <cite style="color: #FF5722;">5</cite>
                                        </p>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md6">
            <div class="layui-card">
                <div class="layui-card-header">快捷方式</div>
                <div class="layui-card-body">
                    <div class="layui-carousel layadmin-carousel layadmin-shortcut">
                        <div carousel-item>
                            <ul class="layui-row layui-col-space10 layui-this">
                                <li class="layui-col-xs3">
                                    <a lay-href="home/homepage1.html">
                                        <i class="layui-icon layui-icon-console"></i>
                                        <cite>未展示</cite>
                                    </a>
                                </li>
                                <li class="layui-col-xs3">
                                    <a lay-href="home/homepage2.html">
                                        <i class="layui-icon layui-icon-chart"></i>
                                        <cite>未展示</cite>
                                    </a>
                                </li>
                                <li class="layui-col-xs3">
                                    <a lay-href="component/layer/list.html">
                                        <i class="layui-icon layui-icon-template-1"></i>
                                        <cite>未展示</cite>
                                    </a>
                                </li>
                                <li class="layui-col-xs3">
                                    <a layadmin-event="im">
                                        <i class="layui-icon layui-icon-chat"></i>
                                        <cite>未展示</cite>
                                    </a>
                                </li>
                                <li class="layui-col-xs3">
                                    <a lay-href="component/progress/index.html">
                                        <i class="layui-icon layui-icon-find-fill"></i>
                                        <cite>未展示</cite>
                                    </a>
                                </li>
                                <li class="layui-col-xs3">
                                    <a lay-href="app/workorder/list.html">
                                        <i class="layui-icon layui-icon-survey"></i>
                                        <cite>未展示</cite>
                                    </a>
                                </li>
                                <li class="layui-col-xs3">
                                    <a lay-href="user/user/list.html">
                                        <i class="layui-icon layui-icon-user"></i>
                                        <cite>未展示</cite>
                                    </a>
                                </li>
                                <li class="layui-col-xs3">
                                    <a lay-href="set/system/website.html">
                                        <i class="layui-icon layui-icon-set"></i>
                                        <cite>未展示</cite>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="layui-col-md4">
    <div class="layui-card">
        <div class="layui-card-header">版本信息</div>
        <div class="layui-card-body layui-text">
            <table class="layui-table">
                <colgroup>
                    <col width="100">
                    <col>
                </colgroup>
                <tbody>
                <tr>
                    <td>当前版本</td>
                    <td>
                        V1.0.0-beta.1
                    </td>
                </tr>
                <tr>
                    <td>基于框架</td>
                    <td>
                        .NET5 + Blazor
                    </td>
                </tr>
                <tr>
                    <td>主要特色</td>
                    <td>开发人员的运维管理平台</td>
                </tr>
                <tr>
                    <td>开源下载</td>
                    <td style="padding-bottom: 0;">
                        <div class="layui-btn-container">
                            <a href="https://github.com/FarseerNet/FOPS" target="_blank" class="layui-btn layui-btn-danger">Github</a>
                            <a href="https://gitee.com/FarseerNet/FOPS" target="_blank" class="layui-btn">Gitee</a>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="layui-card">
        <div class="layui-card-header">效果报告</div>
        <div class="layui-card-body layadmin-takerates">
            <div class="layui-progress" lay-showPercent="yes">
                <h3>转化率（日同比 28% <span class="layui-edge layui-edge-top" lay-tips="增长" lay-offset="-15"></span>）</h3>
                <div class="layui-progress-bar" lay-percent="65%"></div>
            </div>
            <div class="layui-progress" lay-showPercent="yes">
                <h3>签到率（日同比 11% <span class="layui-edge layui-edge-bottom" lay-tips="下降" lay-offset="-15"></span>）</h3>
                <div class="layui-progress-bar" lay-percent="32%"></div>
            </div>
        </div>
    </div>

    <div class="layui-card">
        <div class="layui-card-header">实时监控</div>
        <div class="layui-card-body layadmin-takerates">
            <div class="layui-progress" lay-showPercent="yes">
                <h3>CPU使用率</h3>
                <div class="layui-progress-bar" lay-percent="58%"></div>
            </div>
            <div class="layui-progress" lay-showPercent="yes">
                <h3>内存占用率</h3>
                <div class="layui-progress-bar layui-bg-red" lay-percent="90%"></div>
            </div>
        </div>
    </div>

    <div class="layui-card">
        <div class="layui-card-header">产品动态</div>
        <div class="layui-card-body">
            <div class="layui-carousel layadmin-carousel layadmin-news" data-autoplay="true" data-anim="fade" lay-filter="news">
                <div carousel-item>
                    <div>
                        <a href="http://fly.layui.com/docs/2/" target="_blank" class="layui-bg-red">layuiAdmin 快速上手文档</a>
                    </div>
                    <div>
                        <a href="http://fly.layui.com/vipclub/list/layuiadmin/" target="_blank" class="layui-bg-green">layuiAdmin 会员讨论专区</a>
                    </div>
                    <div>
                        <a href="http://www.layui.com/admin/#get" target="_blank" class="layui-bg-blue">获得 layui 官方后台模板系统</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-card">
        <div class="layui-card-header">
            作者心语
            <i class="layui-icon layui-icon-tips" lay-tips="要支持的噢" lay-offset="5"></i>
        </div>
        <div class="layui-card-body layui-text layadmin-text">
            <p>一直以来，layui 秉承无偿开源的初心，虔诚致力于服务各层次前后端 Web 开发者，在商业横飞的当今时代，这一信念从未动摇。即便身单力薄，仍然重拾决心，埋头造轮，以尽可能地填补产品本身的缺口。</p>
            <p>在过去的一段的时间，我一直在寻求持久之道，已维持你眼前所见的一切。而 layuiAdmin 是我们尝试解决的手段之一。我相信真正有爱于 layui 生态的你，定然不会错过这一拥抱吧。</p>
            <p>子曰：君子不用防，小人防不住。请务必通过官网正规渠道，获得 <a href="http://www.layui.com/admin/" target="_blank">layuiAdmin</a>！</p>
            <p>—— 贤心（<a href="http://www.layui.com/" target="_blank">layui.com</a>）</p>
        </div>
    </div>
</div>
</div>

@code
{
    long _taskGroupCount;
    int _unExecuteCount;
    long _clientCount;
    int _todayFailCount;
    int _projectCount;
    int _gitCount;

    protected override async Task OnInitializedAsync()
    {
        // FSS 任务组数
        _taskGroupCount = await _iocManager.Resolve<ITaskGroupList>().Count();
        // FSS 未执行数
        var lstTaskGroup = await _iocManager.Resolve<ITaskGroupList>().ToListAsync();
        _unExecuteCount = lstTaskGroup.FindAll(o => DateTime.Now > o.NextAt).Count;
        // FSS 客户端数
        _clientCount = await _iocManager.Resolve<INodeClient>().ToClientCountAsync();
        // FSS 今日失败数
        _todayFailCount = await _iocManager.Resolve<ITaskInfo>().TodayFailCountAsync();
        // 项目数量
        _projectCount = await _iocManager.Resolve<IProjectService>().CountAsync();
        // Git数量
        _gitCount = await _iocManager.Resolve<IGitService>().CountAsync();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // 初始化脚本
            await js.InvokeVoidAsync("layuiConfig.use", "index", "console");
        }
    }
}